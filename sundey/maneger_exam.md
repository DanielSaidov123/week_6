# מבחן פרויקט – Workout Manager
מערכת ניהול אימוני כושר המשלבת **SQL, OOP, פונקציות, JSON, CSV, FastAPI**.

> חשוב: המבחן הוא פרויקט אחד מחובר. אין כאן תשובות – רק דרישות ומטלות.  
> המטרה היא שתבנה מערכת עובדת מאפס לפי ההוראות.

---

## הוראות כלליות

1. אפשר לעבוד בכל IDE (VS Code / PyCharm וכו').  
2. ארגן את הפרויקט בתיקיות וקבצים לפי חלקים (SQL, קוד פייתון, FastAPI).  
3. שמור שמות טבלאות, שדות וקבצים בדיוק כמו שמוגדר – כדי שיהיה אפשר לבדוק.  
4. כל חלק במבחן חייב להשתמש בחלקים האחרים (לא לכתוב קוד מנותק).  
5. מותר להוסיף שדות/קבצים/מתודות אם זה עוזר – כל עוד הדרישות המינימליות מתקיימות.

---

## חלק א – SQL ובסיס נתונים

### א.1 יצירת בסיס נתונים

צור בסיס נתונים (Database) בשם:

- `workout_manager`

> הסבר: זה יהיה בסיס הנתונים הראשי של המערכת. כל הטבלאות יצורפו אליו.

### א.2 יצירת טבלאות

צור את הטבלאות הבאות (בשפת SQL), כולל הגדרות סוגי העמודות, מפתחות ראשיים (PRIMARY KEY) וקשרים (FOREIGN KEY):

1. **טבלה: `users`**
   - `id` – מספר מזהה משתמש, INT, מפתח ראשי, AUTO_INCREMENT  
   - `full_name` – שם מלא, VARCHAR(100), חובה (NOT NULL)  
   - `email` – אימייל, VARCHAR(100), חובה, יחודי (UNIQUE)  
   - `join_date` – תאריך הצטרפות, DATE, ברירת מחדל: תאריך נוכחי

2. **טבלה: `exercises`**
   - `id` – INT, מפתח ראשי, AUTO_INCREMENT  
   - `name` – שם התרגיל (Bench Press, Squat וכו'), VARCHAR(100), חובה  
   - `muscle_group` – קבוצת שרירים (Chest, Back, Legs וכו'), VARCHAR(50)

3. **טבלה: `workouts`**
   - `id` – INT, מפתח ראשי, AUTO_INCREMENT  
   - `user_id` – INT, מפתח זר ל־`users(id)`  
   - `date` – DATE, חובה  
   - `notes` – הערות, VARCHAR(255), יכול להיות NULL

4. **טבלה: `workout_exercises`**
   - `id` – INT, מפתח ראשי, AUTO_INCREMENT  
   - `workout_id` – INT, מפתח זר ל־`workouts(id)`  
   - `exercise_id` – INT, מפתח זר ל־`exercises(id)`  
   - `sets` – מספר סטים, INT, חובה, גדול מ־0  
   - `reps` – מספר חזרות, INT, חובה, גדול מ־0  
   - `weight` – משקל בק״ג, DECIMAL(5,2), יכול להיות גם 0 (למשל שכיבות סמיכה)

> הסבר:  
> - הטבלה `users` מחזיקה משתמשים.  
> - הטבלה `exercises` מחזיקה רשימת תרגילים אפשריים.  
> - הטבלה `workouts` מחזיקה אימון של משתמש בתאריך מסוים.  
> - הטבלה `workout_exercises` מחברת בין אימון לתרגילים שבוצעו בו + פרטי הביצוע (סטים/חזרות/משקל).

### א.3 הכנסת נתונים (INSERT)

כתוב פקודות SQL (בלי להריץ כאן) שמכניסות נתונים לדוגמה:

1. הוסף לפחות **3 משתמשים** שונים לטבלת `users`.  
2. הוסף לפחות **5–6 תרגילים** שונים לטבלת `exercises`.  
3. הוסף לפחות **5 אימונים** שונים לטבלת `workouts`.  
4. לכל אימון, הוסף **2–4 רשומות** לטבלת `workout_exercises`.

> הסבר: המטרה היא שתהיה כמות נתונים מספיקה כדי לבדוק שאילתות וסטטיסטיקות.

### א.4 כתיבת שאילתות (ללא פתרונות)

כתוב את השאילתות הבאות (SQL בלבד, בלי הסבר, בלי להריץ כאן):

1. הצג את כל האימונים של משתמש לפי כתובת אימייל (מקבל email ומחזיר את כל האימונים מסודרים מהתאריך החדש לישן).  
2. עבור כל משתמש – הצג כמה אימונים הוא עשה בסך הכול (GROUP BY לפי משתמש).  
3. חשב כמה סטים של תרגיל בשם מסוים (למשל 'Bench Press') בוצעו בסך הכול על ידי כל המשתמשים.  
4. עבור כל משתמש – הצג כמה **תרגילים שונים** הוא ביצע אי פעם (לא כמה שורות, אלא כמה שמות שונים של תרגילים).  
5. צרו שאילתה שמחזירה עבור כל `muscle_group` כמה פעמים היא הופיעה בטבלת `workout_exercises` (כמה שורות שמקושרות לתרגילים בקבוצת שרירים זו).

> הסבר: פה בודקים שימוש ב־JOIN, GROUP BY, פילטרים ו־WHERE. אין לכתוב את התוצאה – רק את השאילתה.

---

## חלק ב – Python, OOP, פונקציות, JSON, CSV

בחלק זה תבנה לוגיקה בפייתון שמייצגת את המערכת באובייקטים, וקוראת/כותבת נתונים מקבצים ומ־DB.

### ב.1 מבנה קבצים מומלץ

צור את הקבצים הבאים (רק הצעה – אפשר לשנות, אבל לשמור על רעיון דומה):

- `models.py` – מחלקות OOP (User, Exercise, Workout וכו').  
- `logic.py` – פונקציות לוגיקה שעובדות עם המחלקות ועם ה־DB.  
- `config.py` – טעינת הגדרות מ־JSON.  
- `data/` – תיקייה לקבצי CSV/JSON (לדוגמה: `data/exercises.csv`, `settings.json`).

### ב.2 מחלקות OOP (בקובץ models.py)

הגדר את המחלקות הבאות (ללא מימוש פתרון כאן):

1. **מחלקה: `User`**
   - שדות: `id`, `full_name`, `email`, `join_date`  
   - בנאי (constructor) שמקבל את השדות האלו.  
   - מתודה `__str__(self)` שמחזירה מחרוזת יפה להצגת המשתמש (למשל: "User 1 – Daniel ...").

2. **מחלקה: `Exercise`**
   - שדות: `id`, `name`, `muscle_group`  
   - בנאי בהתאם.

3. **מחלקה: `WorkoutExercise`**
   - שדות:  
     - `exercise` – אובייקט מסוג `Exercise`  
     - `sets` – מספר סטים (int)  
     - `reps` – מספר חזרות (int)  
     - `weight` – משקל (float או Decimal)  
   - מתודה:
     - `total_volume(self)` – מחזירה את הנפח (volume) של התרגיל = sets * reps * weight.

4. **מחלקה: `Workout`**
   - שדות:  
     - `id` – מזהה אימון  
     - `user` – אובייקט מסוג `User`  
     - `date` – תאריך האימון  
     - `notes` – הערות (יכול להיות None)  
     - `exercises` – רשימה (list) של אובייקטי `WorkoutExercise`  
   - מתודות:
     - `add_exercise(self, workout_exercise)` – מוסיפה תרגיל לרשימת האימון.  
     - `total_workout_volume(self)` – מחזירה את סכום ה־volume של כל התרגילים באימון.

> הסבר:  
> - יש כאן שימוש בקומפוזיציה (Workout מחזיק רשימת WorkoutExercise, שכל אחד מחזיק Exercise).  
> - כך אפשר לבנות אובייקטים מתוחכמים מהנתונים שב־DB או בקבצים.

### ב.3 קובץ JSON להגדרות (settings.json)

צור קובץ בשם `settings.json` (בתיקיית הפרויקט), עם מפתחות כמו:

```json
{
  "db_host": "localhost",
  "db_user": "root",
  "db_password": "",
  "db_name": "workout_manager",
  "default_limit": 10
}
```

> הסבר: לא חייבים להשתמש בדיוק בערכים האלה, אבל המבנה חשוב – כדי שתוכל לקרוא מכאן את פרטי החיבור ל־DB.

ב־`config.py`:

- כתוב פונקציה בשם `load_settings(path: str = "settings.json") -> dict`  
- הפונקציה תקרא את הקובץ JSON ותהפוך אותו ל־dict שניתן להשתמש בו בשאר הקוד.

### ב.4 עבודה עם CSV

1. בתוך התיקייה `data/`, צור קובץ CSV בשם `exercises.csv` עם כותרות ושורות לדוגמה, למשל:  
   - עמודות: `id,name,muscle_group`  
   - מספר שורות של תרגילים.

2. בקובץ `logic.py`, כתוב פונקציה:

   ```python
   def load_exercises_from_csv(path: str) -> list:
       """
       קוראת קובץ CSV ומחזירה רשימה של אובייקטי Exercise.
       """
       ```

   (לא למלא כאן את המימוש – רק לכתוב בקובץ שלך.)

3. כתוב פונקציה נוספת:

   ```python
   def export_user_workouts_to_csv(user_id: int, path: str) -> None:
       """
       מייצאת את כל האימונים של משתמש מסוים לקובץ CSV.
       המבנה של הקובץ לבחירתך (אבל שיהיה קריא והגיוני).
       """
       ```

### ב.5 פונקציות לוגיקה מול DB ואובייקטים

ב־`logic.py`:

1. כתוב פונקציה:

   ```python
   def get_user_from_db(email: str):
       """
       מקבלת email, מחפשת את המשתמש ב-DB ומחזירה אובייקט User או None.
       """
       ```

2. כתוב פונקציה:

   ```python
   def calculate_user_total_volume(user_id: int) -> float:
       """
       מחשבת את סך כל ה-volume של כל האימונים של משתמש מסוים,
       תוך שימוש במחלקות Workout ו-WorkoutExercise.
       """
       ```

> הסבר:  
> - כאן אתה מחבר בין DB ↔ אובייקטים ↔ חישוב לוגי.  
> - המימוש עצמו הוא חלק מהמבחן – לא מופיע כאן.

---

## חלק ג – FastAPI (API מעל המערכת)

בחלק זה תבנה API שמאפשר לעבוד עם המשתמשים והאימונים דרך HTTP.

### ג.1 מבנה בסיסי

צור קובץ `main.py` שבו תגדיר אפליקציית FastAPI:

- יצירת אובייקט `app = FastAPI(...)`  
- הגדרת המסלולים (routes) לפי ההוראות הבאות.

מומלץ ליצור קובץ `schemas.py` למודלי Pydantic.

### ג.2 מודלי Pydantic (ב־schemas.py)

הגדר לפחות את המודלים הבאים (ללא מימוש כאן):

1. `UserOut` – המודל שמוחזר ללקוח כאשר מבקשים משתמש:
   - שדות: `id`, `full_name`, `email`, `join_date`

2. `WorkoutExerciseIn` – תרגיל שנשלח מהלקוח כ־JSON כשמוסיפים אימון:
   - שדות: `exercise_id`, `sets`, `reps`, `weight`

3. `WorkoutCreate` – מבנה JSON ליצירת אימון חדש:
   - שדות: `user_id`, `date`, `notes`, רשימת `exercises` מסוג `WorkoutExerciseIn`.

> הסבר: המודלים האלה משמשים לולידציה ולטיפול נוח בנתוני JSON.

### ג.3 מסלולים (Endpoints) – ללא פתרון

ב־`main.py`, כתוב את ההגדרות (signatures) של המסלולים הבאים, בלי למלא כאן את הקוד:

1. `GET /users`
   - מחזיר רשימת משתמשים.  
   - פרמטרי query אופציונליים: `skip` (ברירת מחדל 0), `limit` (ברירת מחדל מתוך settings.json).  
   - מחזיר רשימת `UserOut`.

2. `GET /users/{user_id}`
   - מחזיר משתמש בודד לפי `user_id`.  
   - אם לא נמצא – יחזיר שגיאת 404.

3. `POST /workouts`
   - מקבל גוף JSON בתבנית `WorkoutCreate`.  
   - יוצר רשומות חדשות בטבלאות `workouts` ו־`workout_exercises`.  
   - מחזיר מידע על האימון שנוצר (מבנה החזרה לבחירתך).

4. `GET /users/{user_id}/workouts`
   - מחזיר את כל האימונים של משתמש מסוים.  
   - פרמטרי query אופציונליים: `from_date`, `to_date` לסינון לפי טווח תאריכים.

5. `GET /users/{user_id}/stats`
   - מחזיר JSON עם סטטיסטיקות על המשתמש, לדוגמה:
     - `total_workouts` – מספר אימונים.  
     - `total_volume` – סך ה-volume.  
     - `favorite_muscle_group` – קבוצת השרירים שמופיעה הכי הרבה באימונים שלו.
   - המסלול צריך להשתמש בפונקציות מ־`logic.py` ולא לבצע את כל החישובים ישירות בתוך ה־endpoint.

### ג.4 שימוש ב־CSV מתוך ה־API

הוסף מסלול נוסף שמשתמש בפונקציית CSV שכתבת:

- `GET /users/{user_id}/export`
  - מפעיל את `export_user_workouts_to_csv` עבור המשתמש.  
  - בגרסה בסיסית: מחזיר JSON כמו `{ "message": "file created" }`.  
  - (מי שרוצה להתקדם – יכול להחזיר את הקובץ עצמו להורדה).

> הסבר: כאן בודקים שילוב בין FastAPI ↔ לוגיקה ↔ CSV.

---

## סיכום

בפרויקט הזה אתה מתאמן על:

- בניית סכמת SQL ויחסים בין טבלאות.  
- כתיבת שאילתות SELECT עם GROUP BY ו־JOIN.  
- תכנון מחלקות OOP שמייצגות את הנתונים.  
- שימוש בפונקציות כדי להפריד לוגיקה וקוד.  
- עבודה עם JSON כקובץ הגדרות ועם CSV לייבוא/ייצוא.  
- בניית API עם FastAPI, כולל GET/POST, Path Parameters, Query Parameters ו־Body.

אין כאן פתרונות – כל המימוש שלך.  
תוכל לסמן לעצמך V ליד כל סעיף שביצעת, ולנסות להריץ ולבדוק הכול מקצה לקצה.
